[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
[include mainsail.cfg]
#[include OrbiterSensor.cfg]
[include macros.cfg]
[include sensorless.cfg]
#[include print_area_bed_mesh.cfg]
#[include KAMP/*cfg]
[include timelapse.cfg]
[include topleds.cfg]
[include nevermore.cfg]
[include ebb36.cfg]
[include carto.cfg]
#[include ERCF.cfg]

[mcu rpi]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 0c5a285e7f21

[gcode_arcs]
resolution: .1

[exclude_object]

[gcode_macro FAKE_POSITION]
gcode:
        SET_KINEMATIC_POSITION X=10 Y=10 Z=10

[force_move]
enable_force_move:Â True

[input_shaper]



[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 5500		        
max_z_velocity: 30			
max_z_accel: 350
square_corner_velocity: 5.0



#####################################################################
#      X/Y Stepper Settings
#####################################################################

[stepper_x]
##	Connected to X-MOT (B Motor)
step_pin: PE11
dir_pin: !PE10
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 400 for 0.9 degree stepper
#endstop_pin: ^!PB14
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 50   #Max 100
homing_retract_dist: 0
homing_positive_dir: true


[tmc2209 stepper_x]
uart_pin: PE7
interpolate: True
run_current: 1
#hold_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 150
diag_pin: PB14

[stepper_y]
##	Connected to Y-MOT (A Motor)
step_pin: PD8
dir_pin: !PB12
enable_pin: !PD9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 400 for 0.9 degree stepper
#endstop_pin: ^PB13
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 0
position_max: 355
homing_speed: 50  #Max 100
homing_retract_dist: 0
homing_positive_dir: false

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PE15
interpolate: True
run_current: 1
#hold_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 147
diag_pin: PB13


#####################################################################
#   Z Stepper Settings
#####################################################################

## In Z-MOT Position
## Z0 Stepper - Front Left
[stepper_z]
step_pin: PD14
dir_pin: !PD13
enable_pin: !PD15
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
##  In Z- Position
#endstop_pin: probe:z_virtual_endstop
#endstop_pin: EBBCan: PB8
endstop_pin: probe:z_virtual_endstop
position_max: 340
position_min: -5
homing_speed: 20
second_homing_speed: 1
homing_retract_dist: 0

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PD10
interpolate: True
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E1-MOT Position
##	Z1 Stepper - Rear Left
[stepper_z1]
step_pin: PE6
dir_pin: PC13
enable_pin: !PE5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC14
interpolate: True
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E2-MOT Position
##	Z2 Stepper - Rear Right
[stepper_z2]
step_pin: PE2
dir_pin: !PE4
enable_pin: !PE3
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PC15
interpolate: true
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E3-MOT Position
##	Z3 Stepper - Front Right
[stepper_z3]
step_pin: PD12
dir_pin: PC4
enable_pin: !PE8
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PA15
interpolate: true
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
##	SSR Pin - In BED OUT position
heater_pin: PB4
sensor_type: Generic 3950 # NTC 100K MGB18-104F39050L32
sensor_pin: PB0 # TB Position
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.6
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.0166
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
#	Fan Control
#####################################################################


#[controller_fan spiderfan]
#pin: PA13
#fan_speed: 1
#stepper: stepper_x,stepper_y

[temperature_fan electronics1]
pin: PA13 #This is where you change the mcu name and/or pin
control: watermark #This is the hysteresis we will use instead of pid.
max_delta: 3.0 #How much to go over/under target temp before toggling the fan
#shutdown_speed: 1 #Turn the fan on at max if an error causes shutdown
sensor_type: temperature_host #this is where we get the temperature
min_temp: 0 #min/max are just for sanity checks to detect a malfunctioning sensor
max_temp: 100
target_temp: 30.0 #The temperature at which to toggle the fan

[temperature_fan electronics2]
pin: PB2 #This is where you change the mcu name and/or pin
control: watermark #This is the hysteresis we will use instead of pid.
max_delta: 5.0 #How much to go over/under target temp before toggling the fan
shutdown_speed: 1 #Turn the fan on at max if an error causes shutdown
sensor_type: temperature_host #this is where we get the temperature
min_temp: 0 #min/max are just for sanity checks to detect a malfunctioning sensor
max_temp: 100
target_temp: 30.0 #The temperature at which to toggle the fan

[temperature_sensor chamber]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PC3
min_temp: 0
max_temp: 100
gcode_id: C

[temperature_sensor frame]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PB1
min_temp: 0
max_temp: 100
gcode_id: F


#####################################################################
#	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

[safe_z_home]
##	XY Location of the Z Endstop Switch
##	Update -100,-100 to the XY coordinates of your endstop pin 
##	(such as 157,305) after going through Z Endstop Pin
##	Location Definition step.
home_xy_position:175,175
speed:100
z_hop:10
   
[quad_gantry_level]
gantry_corners:
	-60,-10
	410,420
points:
	50,25
	50,275
	300,275
	300,25
speed: 400
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0075
max_adjust: 10

#####################################################################
#	Displays
#####################################################################

#--------------------------------------------------------------------

[display]
#	mini12864 LCD Display
lcd_type: uc1701
cs_pin: PC11
a0_pin: PD2
rst_pin: PC10
encoder_pins: ^PC6,^PC7
click_pin: ^!PA8
contrast: 63
#spi_bus: spi1
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
spi_software_sclk_pin: PA5

[neopixel fysetc_mini12864]
#	To control Neopixel RGB in mini12864 display
pin: PC12
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.0
color_order: RGB

#	Set RGB values on boot up for each Neopixel. 
#	Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3 

[gcode_macro G32]
gcode:
    BED_MESH_CLEAR
    G28
    QUAD_GANTRY_LEVEL
    G28Z
    G0 X175 Y175 Z30 F3600

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 40.456
#*# pid_ki = 1.335
#*# pid_kd = 306.452
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.131598, -0.137053, -0.137032, -0.136538, -0.133855, -0.131793, -0.132256, -0.132243, -0.131297, -0.127916, -0.122553, -0.111046, -0.112422, -0.102617, -0.089901, -0.102443, -0.104977, -0.107369, -0.109455, -0.109902, -0.107704, -0.111177, -0.108558, -0.113633, -0.122757, -0.126008, -0.132658, -0.137582, -0.136774, -0.139205
#*# 	  -0.139891, -0.140392, -0.138660, -0.140831, -0.139823, -0.139101, -0.136223, -0.134643, -0.129639, -0.125825, -0.120766, -0.113935, -0.111544, -0.105304, -0.096957, -0.104005, -0.106623, -0.107351, -0.107034, -0.109269, -0.110785, -0.110049, -0.108114, -0.108540, -0.114679, -0.121508, -0.128830, -0.136792, -0.141075, -0.138074
#*# 	  -0.135334, -0.135259, -0.128593, -0.128822, -0.129086, -0.125256, -0.123743, -0.122241, -0.120548, -0.107638, -0.102959, -0.095160, -0.093142, -0.091312, -0.086206, -0.089954, -0.090904, -0.093297, -0.093702, -0.093794, -0.095337, -0.100471, -0.092493, -0.093506, -0.100175, -0.107025, -0.117118, -0.123772, -0.127766, -0.126655
#*# 	  -0.124182, -0.119556, -0.114986, -0.112441, -0.112546, -0.117169, -0.111346, -0.111062, -0.101634, -0.095451, -0.081907, -0.077535, -0.068511, -0.069886, -0.076121, -0.076797, -0.076765, -0.080057, -0.080721, -0.074295, -0.071039, -0.076793, -0.077220, -0.075762, -0.085326, -0.087826, -0.098729, -0.105521, -0.110758, -0.107737
#*# 	  -0.120949, -0.110863, -0.099798, -0.093186, -0.098951, -0.093192, -0.093674, -0.089642, -0.076474, -0.067039, -0.054295, -0.044303, -0.050833, -0.045280, -0.051893, -0.058318, -0.056975, -0.060130, -0.061231, -0.057392, -0.056800, -0.056854, -0.061130, -0.063770, -0.066870, -0.072695, -0.079968, -0.086001, -0.089738, -0.090075
#*# 	  -0.113597, -0.106754, -0.099840, -0.087454, -0.092638, -0.089278, -0.078714, -0.075675, -0.061207, -0.048476, -0.030190, -0.018328, -0.022824, -0.024985, -0.029219, -0.038063, -0.040990, -0.042702, -0.048537, -0.043001, -0.048807, -0.051732, -0.050569, -0.055595, -0.057656, -0.062223, -0.063046, -0.066767, -0.068321, -0.068528
#*# 	  -0.109039, -0.099955, -0.094724, -0.090940, -0.085744, -0.080830, -0.075612, -0.066798, -0.049015, -0.029117, 0.002407, 0.006158, 0.006924, 0.003327, -0.004369, -0.014344, -0.022578, -0.020508, -0.036884, -0.035073, -0.037237, -0.040917, -0.039843, -0.048793, -0.048678, -0.052759, -0.053355, -0.048268, -0.044943, -0.046641
#*# 	  -0.080878, -0.079881, -0.069332, -0.073153, -0.059482, -0.064866, -0.058822, -0.045160, -0.026082, 0.000113, 0.033181, 0.049597, 0.055281, 0.042789, 0.026817, 0.013792, 0.003267, -0.002420, -0.005377, -0.010973, -0.013656, -0.020805, -0.024392, -0.027864, -0.026267, -0.027961, -0.029786, -0.025661, -0.022087, -0.020503
#*# 	  -0.060671, -0.058341, -0.045920, -0.043600, -0.040323, -0.045457, -0.045568, -0.028584, -0.009421, 0.027669, 0.051281, 0.085705, 0.093709, 0.075472, 0.048168, 0.029631, 0.027224, 0.014264, 0.011144, 0.007527, 0.008204, 0.001152, -0.008443, -0.003343, -0.003476, -0.007823, -0.009954, -0.014074, -0.006195, -0.002547
#*# 	  -0.057652, -0.052180, -0.038122, -0.040576, -0.031771, -0.041175, -0.040200, -0.028042, -0.012150, 0.019230, 0.044022, 0.079748, 0.095089, 0.075201, 0.052772, 0.025210, 0.012456, -0.006195, -0.004606, 0.003106, 0.004095, 0.003772, -0.001996, -0.001568, -0.001339, -0.004184, -0.005862, -0.006903, -0.008678, -0.008419
#*# 	  -0.068613, -0.057812, -0.046103, -0.058432, -0.045366, -0.053824, -0.050833, -0.033916, -0.031272, -0.011745, 0.028525, 0.047177, 0.055793, 0.042920, 0.030007, 0.002863, -0.010792, -0.018370, -0.015915, -0.011449, -0.010342, -0.007090, -0.008687, -0.008044, -0.011476, -0.014847, -0.013546, -0.015011, -0.020780, -0.022056
#*# 	  -0.076385, -0.070534, -0.068427, -0.065232, -0.063375, -0.065157, -0.066436, -0.054807, -0.039097, -0.023348, -0.005472, 0.004944, 0.005073, -0.004423, 0.001660, -0.019046, -0.023661, -0.030019, -0.025796, -0.021052, -0.015730, -0.014272, -0.017230, -0.015469, -0.014790, -0.016948, -0.018330, -0.025012, -0.028387, -0.029201
#*# 	  -0.084037, -0.078887, -0.070874, -0.072145, -0.071150, -0.068504, -0.063371, -0.043059, -0.043810, -0.037164, -0.030277, -0.016654, -0.020686, -0.032573, -0.018203, -0.028831, -0.030917, -0.024814, -0.021251, -0.019542, -0.018406, -0.018045, -0.017102, -0.011174, -0.018148, -0.011675, -0.016918, -0.024420, -0.032487, -0.018229
#*# 	  -0.086826, -0.068431, -0.069847, -0.067245, -0.062988, -0.062610, -0.062949, -0.041109, -0.035576, -0.035345, -0.029359, -0.025462, -0.022120, -0.021713, -0.017970, -0.020198, -0.015848, -0.010517, -0.004548, -0.009344, -0.009345, -0.009584, -0.004363, 0.003447, -0.007836, 0.002425, -0.004866, -0.010490, -0.016575, 0.000174
#*# 	  -0.068452, -0.064497, -0.056932, -0.054868, -0.050793, -0.047416, -0.047790, -0.030866, -0.023937, -0.026552, -0.012369, -0.018409, -0.011833, -0.012014, -0.009149, -0.004170, -0.000500, 0.006567, 0.010137, 0.009064, 0.003192, -0.003741, 0.007521, 0.016185, 0.002392, 0.001558, 0.007759, 0.001803, -0.003605, 0.012733
#*# 	  -0.065008, -0.061386, -0.051677, -0.050555, -0.034065, -0.044962, -0.041481, -0.027699, -0.029466, -0.015483, -0.014689, -0.010317, -0.006512, -0.004166, -0.001730, 0.000000, 0.002792, 0.005779, 0.009693, 0.007832, 0.003806, -0.001343, 0.012874, 0.015630, 0.010501, 0.007356, 0.005123, 0.004234, 0.000258, 0.014014
#*# 	  -0.062218, -0.060434, -0.055744, -0.050728, -0.041685, -0.044736, -0.038588, -0.030843, -0.024747, -0.028117, -0.006677, -0.006262, -0.011887, -0.012937, -0.012064, -0.006929, -0.006012, -0.003559, -0.003502, 0.002305, 0.002433, -0.000751, 0.006853, 0.011907, 0.011593, 0.004969, -0.002081, -0.003007, -0.003471, 0.003527
#*# 	  -0.064417, -0.059974, -0.056772, -0.046539, -0.045712, -0.046303, -0.043177, -0.036548, -0.033949, -0.029332, -0.023066, -0.030606, -0.019691, -0.017717, -0.018150, -0.016765, -0.014630, -0.012428, -0.008224, -0.004955, -0.007361, -0.006754, -0.003427, 0.001254, -0.000513, -0.006651, -0.010464, -0.016305, -0.020590, -0.008645
#*# 	  -0.073304, -0.071621, -0.064587, -0.059153, -0.058171, -0.055248, -0.049169, -0.053027, -0.049396, -0.046285, -0.045188, -0.041447, -0.038104, -0.035800, -0.033288, -0.028290, -0.023520, -0.022642, -0.021853, -0.022937, -0.025918, -0.022286, -0.021162, -0.018068, -0.017030, -0.022549, -0.028125, -0.030194, -0.034159, -0.033352
#*# 	  -0.074217, -0.070648, -0.067343, -0.059112, -0.058141, -0.056958, -0.055522, -0.054048, -0.051084, -0.050487, -0.048398, -0.041184, -0.040910, -0.035469, -0.029812, -0.026302, -0.016186, -0.022516, -0.023378, -0.022519, -0.022148, -0.017460, -0.021683, -0.019023, -0.018468, -0.024140, -0.028420, -0.030195, -0.036514, -0.038033
#*# 	  -0.062506, -0.063624, -0.058509, -0.052163, -0.049958, -0.050026, -0.051870, -0.048677, -0.043799, -0.043367, -0.040278, -0.033405, -0.029908, -0.024400, -0.022230, -0.016791, -0.014726, -0.010210, -0.016019, -0.013890, -0.012662, -0.011405, -0.013704, -0.010894, -0.011282, -0.018571, -0.025022, -0.016401, -0.029652, -0.030032
#*# 	  -0.052651, -0.051401, -0.046850, -0.041526, -0.041362, -0.041706, -0.038824, -0.039205, -0.032144, -0.031729, -0.030901, -0.028738, -0.024060, -0.017522, -0.015395, -0.015751, -0.010576, -0.011702, -0.014830, -0.013795, -0.010032, -0.005257, -0.012654, -0.015053, -0.011324, -0.015565, -0.022423, -0.023173, -0.032027, -0.035937
#*# 	  -0.061184, -0.062477, -0.059331, -0.056421, -0.054168, -0.052359, -0.052200, -0.050268, -0.047937, -0.046253, -0.045259, -0.041901, -0.037735, -0.034215, -0.035913, -0.032877, -0.031979, -0.027043, -0.028681, -0.031242, -0.026421, -0.023492, -0.029342, -0.029485, -0.030238, -0.032713, -0.036912, -0.039883, -0.046483, -0.047829
#*# 	  -0.073532, -0.077888, -0.077564, -0.074279, -0.072129, -0.070826, -0.067603, -0.065624, -0.061001, -0.060684, -0.058467, -0.055744, -0.050552, -0.049317, -0.046109, -0.045353, -0.044672, -0.042175, -0.045605, -0.043457, -0.038884, -0.040503, -0.039566, -0.038049, -0.042021, -0.043929, -0.047300, -0.051376, -0.054654, -0.057007
#*# 	  -0.085312, -0.090116, -0.091081, -0.090537, -0.086739, -0.084415, -0.084392, -0.084722, -0.077762, -0.073729, -0.069009, -0.063790, -0.061591, -0.061701, -0.056341, -0.048636, -0.042723, -0.046024, -0.053666, -0.055106, -0.048709, -0.049338, -0.048613, -0.051418, -0.054591, -0.055624, -0.059564, -0.056874, -0.063764, -0.067232
#*# 	  -0.091753, -0.098634, -0.103135, -0.103011, -0.099628, -0.097441, -0.096432, -0.095704, -0.093078, -0.086757, -0.084993, -0.080059, -0.074700, -0.068519, -0.064417, -0.060388, -0.054272, -0.058251, -0.060768, -0.063092, -0.060228, -0.056930, -0.062914, -0.068970, -0.072815, -0.072632, -0.073530, -0.076132, -0.083526, -0.088883
#*# 	  -0.109076, -0.114754, -0.117530, -0.116999, -0.117488, -0.113249, -0.112575, -0.113865, -0.111333, -0.108426, -0.104809, -0.100538, -0.094956, -0.087774, -0.084333, -0.081209, -0.077478, -0.075641, -0.078857, -0.078306, -0.080265, -0.082154, -0.084806, -0.087573, -0.092350, -0.099298, -0.104333, -0.108768, -0.115142, -0.118103
#*# 	  -0.128764, -0.134380, -0.139362, -0.139249, -0.143454, -0.138514, -0.139435, -0.138413, -0.134812, -0.134514, -0.132973, -0.127264, -0.120594, -0.112863, -0.109126, -0.106342, -0.100714, -0.098679, -0.099290, -0.101968, -0.104110, -0.109248, -0.111722, -0.112268, -0.116688, -0.126711, -0.132199, -0.138384, -0.146272, -0.150365
#*# 	  -0.154903, -0.158611, -0.160847, -0.163220, -0.164413, -0.168859, -0.166549, -0.165658, -0.169170, -0.163803, -0.159352, -0.155299, -0.151859, -0.145808, -0.140341, -0.132979, -0.129947, -0.129957, -0.133426, -0.131170, -0.130552, -0.136145, -0.141825, -0.146378, -0.150474, -0.158439, -0.165694, -0.171164, -0.178420, -0.183932
#*# 	  -0.176233, -0.186298, -0.184874, -0.186768, -0.191629, -0.191394, -0.190812, -0.192487, -0.195218, -0.190636, -0.186838, -0.182360, -0.176840, -0.172298, -0.169297, -0.163941, -0.158778, -0.158383, -0.159713, -0.158661, -0.154609, -0.157475, -0.164903, -0.169494, -0.174377, -0.184560, -0.193335, -0.203373, -0.208521, -0.215946
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 310.0
#*# min_y = 30.0
#*# max_y = 310.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.714
#*# pid_ki = 2.313
#*# pid_kd = 77.138
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 75.6
#*# shaper_type_y = mzv
#*# shaper_freq_y = 42.4
#*#
#*# [scanner model default]
#*# model_coef = 1.4728773420505683,
#*# 	1.898003207995422,
#*# 	0.8661361751480499,
#*# 	0.782595127600271,
#*# 	-0.14336385016983633,
#*# 	-1.4740049683240652,
#*# 	0.6778401631340429,
#*# 	2.439377020269552,
#*# 	-0.2678509915704753,
#*# 	-1.1390094522587744
#*# model_domain = 3.2193633241818257e-07,3.311308046461084e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 36.254154
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1750
#*# scanner_touch_speed = 3
