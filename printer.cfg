[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
[include mainsail.cfg]

[include macros.cfg]
[include sensorless.cfg]

[include KAMP/KAMP_Settings.cfg]
[include timelapse.cfg]
[include topleds.cfg]
[include nevermore.cfg]
[include ebb36.cfg]
[include carto.cfg]
#[include ERCF.cfg]

[mcu rpi]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 0c5a285e7f21

[gcode_arcs]
resolution: .1

[exclude_object]

[gcode_macro FAKE_POSITION]
gcode:
        SET_KINEMATIC_POSITION X=10 Y=10 Z=10

[force_move]
enable_force_move:Â True

[input_shaper]



[printer]
kinematics: corexy
max_velocity: 500
max_accel: 7000		        
max_z_velocity: 30			
max_z_accel: 350
square_corner_velocity: 5.0



#####################################################################
#      X/Y Stepper Settings
#####################################################################

[stepper_x]
##	Connected to X-MOT (B Motor)
step_pin: PE11
dir_pin: !PE10
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 400 for 0.9 degree stepper
#endstop_pin: ^!PB14
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 50   #Max 100
homing_retract_dist: 0
homing_positive_dir: true


[tmc2209 stepper_x]
uart_pin: PE7
interpolate: True
run_current: 1
#hold_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 150
diag_pin: PB14

[stepper_y]
##	Connected to Y-MOT (A Motor)
step_pin: PD8
dir_pin: !PB12
enable_pin: !PD9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation:400  #set to 400 for 0.9 degree stepper
#endstop_pin: ^PB13
endstop_pin: ^PA2
position_min: 0
position_endstop: 355
position_max: 355
homing_speed: 50  #Max 100
homing_retract_dist: 0
homing_positive_dir: true

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_y]
uart_pin: PE15
interpolate: True
run_current: 1
#hold_current: 0.4
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 140
diag_pin: PB13


#####################################################################
#   Z Stepper Settings
#####################################################################

## In Z-MOT Position
## Z0 Stepper - Front Left
[stepper_z]
step_pin: PD14
dir_pin: !PD13
enable_pin: !PD15
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16
##  In Z- Position
#endstop_pin: probe:z_virtual_endstop
#endstop_pin: EBBCan: PB8
endstop_pin: probe:z_virtual_endstop
position_max: 340
position_min: -5
homing_speed: 20
second_homing_speed: 1
homing_retract_dist: 0

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z]
uart_pin: PD10
interpolate: True
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E1-MOT Position
##	Z1 Stepper - Rear Left
[stepper_z1]
step_pin: PE6
dir_pin: PC13
enable_pin: !PE5
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z1]
uart_pin: PC14
interpolate: True
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E2-MOT Position
##	Z2 Stepper - Rear Right
[stepper_z2]
step_pin: PE2
dir_pin: !PE4
enable_pin: !PE3
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

##	Make sure to update below for your relevant driver (2208 or 2209)
[tmc2209 stepper_z2]
uart_pin: PC15
interpolate: true
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0

##	In E3-MOT Position
##	Z3 Stepper - Front Right
[stepper_z3]
step_pin: PD12
dir_pin: PC4
enable_pin: !PE8
rotation_distance: 40
gear_ratio: 80:16
microsteps: 16

[tmc2209 stepper_z3]
uart_pin: PA15
interpolate: true
run_current: 0.7
#hold_current: 0.4
sense_resistor: 0.110
#stealthchop_threshold: 0


#####################################################################
#   Bed Heater
#####################################################################
[heater_bed]
##	SSR Pin - In BED OUT position
heater_pin: PB4
sensor_type: Generic 3950 # NTC 100K MGB18-104F39050L32
sensor_pin: PB0 # TB Position
##	Adjust Max Power so your heater doesn't warp your bed
max_power: 0.6
min_temp: 0
max_temp: 120
pwm_cycle_time: 0.0166
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
#	Fan Control
#####################################################################


#[controller_fan spiderfan]
#pin: PA13
#fan_speed: 1
#stepper: stepper_x,stepper_y

[temperature_fan electronics1]
pin: PA13 #This is where you change the mcu name and/or pin
control: watermark #This is the hysteresis we will use instead of pid.
max_delta: 3.0 #How much to go over/under target temp before toggling the fan
#shutdown_speed: 1 #Turn the fan on at max if an error causes shutdown
sensor_type: temperature_host #this is where we get the temperature
min_temp: 0 #min/max are just for sanity checks to detect a malfunctioning sensor
max_temp: 100
target_temp: 30.0 #The temperature at which to toggle the fan

[temperature_fan electronics2]
pin: PB2 #This is where you change the mcu name and/or pin
control: watermark #This is the hysteresis we will use instead of pid.
max_delta: 5.0 #How much to go over/under target temp before toggling the fan
shutdown_speed: 1 #Turn the fan on at max if an error causes shutdown
sensor_type: temperature_host #this is where we get the temperature
min_temp: 0 #min/max are just for sanity checks to detect a malfunctioning sensor
max_temp: 100
target_temp: 30.0 #The temperature at which to toggle the fan

[temperature_sensor chamber]
sensor_type: NTC 100K MGB18-104F39050L32
sensor_pin: PC3
min_temp: 0
max_temp: 100
gcode_id: C

#[temperature_sensor frame]
#sensor_type: NTC 100K MGB18-104F39050L32
#sensor_pin: PB1
#min_temp: 0
#max_temp: 100
#gcode_id: F


#####################################################################
#	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 1800

#[safe_z_home]
##	XY Location of the Z Endstop Switch
##	Update -100,-100 to the XY coordinates of your endstop pin 
##	(such as 157,305) after going through Z Endstop Pin
##	Location Definition step.
#home_xy_position:175,175
#speed:100
#z_hop:10
   
[quad_gantry_level]
gantry_corners:
	-60,-10
	410,420
points:
	50,25
	50,275
	300,275
	300,25
speed: 400
horizontal_move_z: 10
retries: 5
retry_tolerance: 0.0055
max_adjust: 10

#####################################################################
#	Displays
#####################################################################

#--------------------------------------------------------------------

[display]
#	mini12864 LCD Display
lcd_type: uc1701
cs_pin: PC11
a0_pin: PD2
rst_pin: PC10
encoder_pins: ^PC6,^PC7
click_pin: ^!PA8
contrast: 63
#spi_bus: spi1
spi_software_mosi_pin: PA7
spi_software_miso_pin: PA6
spi_software_sclk_pin: PA5

[neopixel fysetc_mini12864]
#	To control Neopixel RGB in mini12864 display
pin: PC12
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.0
color_order: RGB

#	Set RGB values on boot up for each Neopixel. 
#	Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3 

[gcode_macro G32]
gcode:
    BED_MESH_CLEAR
    G28
    QUAD_GANTRY_LEVEL
    G28Z
    G0 X175 Y175 Z30 F3600

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 40.456
#*# pid_ki = 1.335
#*# pid_kd = 306.452
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.076809, -0.076957, -0.071021, -0.063897, -0.063720, -0.061982, -0.060276, -0.063645, -0.061950, -0.061053, -0.058509, -0.046406, -0.046613, -0.041607, -0.029832, -0.035433, -0.036871, -0.035831, -0.036791, -0.035312, -0.035929, -0.035924, -0.038761, -0.041627, -0.051231, -0.055658, -0.064644, -0.069751, -0.071765, -0.074458
#*# 	-0.078744, -0.076379, -0.073303, -0.073447, -0.074695, -0.072667, -0.071455, -0.068359, -0.061884, -0.056749, -0.053663, -0.046567, -0.043857, -0.039040, -0.032507, -0.037546, -0.039490, -0.038299, -0.037333, -0.043317, -0.042194, -0.041635, -0.041676, -0.044155, -0.052941, -0.058629, -0.063060, -0.072392, -0.074570, -0.078340
#*# 	-0.075719, -0.075057, -0.068180, -0.069173, -0.066725, -0.062549, -0.062794, -0.061925, -0.053912, -0.043441, -0.037143, -0.033513, -0.029509, -0.027972, -0.025672, -0.031418, -0.031816, -0.033570, -0.030179, -0.030458, -0.034671, -0.036861, -0.028663, -0.035381, -0.043158, -0.050250, -0.057964, -0.063621, -0.068527, -0.072228
#*# 	-0.068964, -0.064331, -0.060478, -0.053759, -0.054703, -0.057485, -0.053106, -0.051622, -0.043304, -0.038207, -0.023214, -0.021275, -0.012635, -0.013679, -0.019740, -0.019988, -0.021003, -0.025375, -0.022878, -0.018880, -0.017584, -0.021984, -0.022001, -0.022267, -0.029323, -0.035760, -0.046817, -0.052885, -0.061404, -0.055379
#*# 	-0.066955, -0.060858, -0.054314, -0.042205, -0.045625, -0.043664, -0.043342, -0.038112, -0.024012, -0.016690, -0.006197, 0.006460, -0.001580, 0.001281, -0.003198, -0.008720, -0.007163, -0.013670, -0.015982, -0.010614, -0.012954, -0.008714, -0.015111, -0.018689, -0.021960, -0.029555, -0.035832, -0.042058, -0.044409, -0.046570
#*# 	-0.072277, -0.063979, -0.057163, -0.043052, -0.046454, -0.043782, -0.033783, -0.030721, -0.017884, -0.007782, 0.008006, 0.017098, 0.016173, 0.014071, 0.009204, -0.000108, -0.001100, -0.003966, -0.009202, -0.008238, -0.012365, -0.009273, -0.016727, -0.021722, -0.024901, -0.030105, -0.031101, -0.033366, -0.038036, -0.035188
#*# 	-0.068604, -0.057043, -0.056791, -0.047184, -0.046167, -0.041418, -0.037688, -0.029011, -0.011067, 0.006249, 0.025994, 0.032713, 0.036317, 0.032238, 0.025029, 0.016138, 0.006772, 0.013800, -0.003777, -0.004189, -0.009360, -0.012093, -0.018396, -0.023452, -0.027016, -0.028881, -0.025441, -0.021761, -0.023411, -0.025076
#*# 	-0.045519, -0.044625, -0.031049, -0.035840, -0.024517, -0.031486, -0.026027, -0.013618, 0.003534, 0.028181, 0.053644, 0.074049, 0.075503, 0.062015, 0.047931, 0.036205, 0.026470, 0.019585, 0.019107, 0.015157, 0.008855, -0.000486, -0.004066, -0.004060, -0.005891, -0.014943, -0.009338, -0.008464, -0.005425, -0.004601
#*# 	-0.033102, -0.030254, -0.018267, -0.012864, -0.013674, -0.018682, -0.018912, 0.000356, 0.013975, 0.048655, 0.067179, 0.103208, 0.106169, 0.085051, 0.060059, 0.043781, 0.041399, 0.026396, 0.023777, 0.023491, 0.023570, 0.013466, 0.003560, 0.010593, 0.008285, 0.002470, -0.003160, -0.007163, 0.001366, 0.001235
#*# 	-0.035671, -0.027238, -0.014425, -0.016649, -0.010171, -0.021278, -0.019646, -0.010445, 0.004599, 0.032653, 0.058532, 0.091797, 0.101553, 0.079437, 0.055075, 0.030577, 0.017692, 0.002253, 0.004102, 0.010815, 0.009090, 0.006699, 0.002470, -0.000900, 0.000608, -0.006487, -0.006731, -0.009624, -0.013389, -0.016309
#*# 	-0.051788, -0.039273, -0.031369, -0.040190, -0.032883, -0.039112, -0.034929, -0.020354, -0.022032, -0.002349, 0.031211, 0.054348, 0.058180, 0.045074, 0.027314, 0.003975, -0.008760, -0.017577, -0.013443, -0.012165, -0.012380, -0.011625, -0.012437, -0.009124, -0.018751, -0.023560, -0.018273, -0.021366, -0.032152, -0.034955
#*# 	-0.057903, -0.052903, -0.049811, -0.049198, -0.050298, -0.051448, -0.052725, -0.039148, -0.026730, -0.016770, -0.004320, 0.009112, 0.004987, -0.002118, 0.001507, -0.020428, -0.022823, -0.027060, -0.023836, -0.020703, -0.020588, -0.019380, -0.020497, -0.020175, -0.020939, -0.028129, -0.026312, -0.032232, -0.039893, -0.037467
#*# 	-0.068017, -0.063423, -0.056121, -0.055721, -0.057200, -0.055304, -0.052818, -0.032706, -0.033938, -0.032246, -0.026530, -0.017327, -0.020211, -0.032383, -0.016788, -0.021943, -0.029821, -0.029328, -0.025480, -0.024028, -0.021947, -0.024765, -0.025351, -0.019892, -0.026286, -0.018269, -0.030290, -0.033846, -0.042105, -0.027714
#*# 	-0.072053, -0.053648, -0.054595, -0.050853, -0.048296, -0.046752, -0.048624, -0.028424, -0.029721, -0.027369, -0.020379, -0.021901, -0.021633, -0.019779, -0.015461, -0.016232, -0.013260, -0.011922, -0.011156, -0.011387, -0.012469, -0.015903, -0.011095, -0.005689, -0.017125, -0.009035, -0.017237, -0.022186, -0.028185, -0.012109
#*# 	-0.055882, -0.051798, -0.043714, -0.042168, -0.035557, -0.035872, -0.038432, -0.024363, -0.019513, -0.019562, -0.008014, -0.015079, -0.011271, -0.009084, -0.007488, -0.005171, -0.000380, 0.003282, 0.003499, 0.001480, -0.004114, -0.006944, 0.005558, 0.004196, -0.006886, -0.009902, -0.003444, -0.008534, -0.014887, -0.000032
#*# 	-0.050133, -0.043706, -0.041072, -0.036421, -0.022718, -0.033606, -0.032037, -0.022163, -0.025647, -0.012780, -0.010336, -0.007023, -0.005416, -0.004355, -0.002225, -0.000267, -0.000671, 0.003003, 0.004583, 0.001494, -0.002211, -0.008312, 0.007555, 0.006961, 0.000953, -0.000843, -0.004818, -0.005938, -0.010357, -0.004968
#*# 	-0.049003, -0.047575, -0.041402, -0.036292, -0.030601, -0.033759, -0.029914, -0.021280, -0.014533, -0.020055, -0.003271, -0.004685, -0.009458, -0.009513, -0.008705, -0.008439, -0.005032, -0.006426, -0.003399, 0.002089, 0.000084, -0.004159, 0.002694, 0.005109, 0.005749, -0.000901, -0.007610, -0.008238, -0.009889, -0.010497
#*# 	-0.046570, -0.044253, -0.040000, -0.033111, -0.031822, -0.031983, -0.028606, -0.025192, -0.022073, -0.018660, -0.015403, -0.019784, -0.014255, -0.011001, -0.013459, -0.012949, -0.008960, -0.010633, -0.006469, -0.001663, -0.006450, -0.004252, -0.005172, -0.001043, -0.001179, -0.008837, -0.013130, -0.020924, -0.023819, -0.015666
#*# 	-0.055230, -0.051863, -0.047285, -0.042561, -0.044107, -0.037794, -0.034348, -0.038775, -0.034481, -0.032918, -0.034305, -0.032396, -0.032789, -0.025258, -0.020973, -0.018698, -0.015372, -0.016457, -0.015701, -0.017190, -0.018371, -0.016927, -0.016649, -0.019204, -0.017422, -0.020080, -0.022750, -0.028015, -0.033258, -0.034453
#*# 	-0.051500, -0.047189, -0.046580, -0.037599, -0.037542, -0.038635, -0.038062, -0.034824, -0.032646, -0.032799, -0.030681, -0.027363, -0.024734, -0.019382, -0.012922, -0.010993, -0.004216, -0.009241, -0.010541, -0.008546, -0.009070, -0.006955, -0.010363, -0.010488, -0.013129, -0.016961, -0.018521, -0.019781, -0.031024, -0.031155
#*# 	-0.036648, -0.040241, -0.031084, -0.024103, -0.022153, -0.026273, -0.027684, -0.022221, -0.016466, -0.016717, -0.019167, -0.013443, -0.008308, -0.000263, -0.000414, 0.003246, 0.004354, 0.006105, 0.003210, 0.003267, 0.007936, 0.006913, 0.003397, 0.003902, 0.000735, -0.004460, -0.007854, -0.003982, -0.013830, -0.020984
#*# 	-0.022142, -0.021969, -0.017282, -0.013718, -0.016978, -0.015709, -0.011322, -0.010601, -0.006291, -0.007502, -0.006576, -0.003146, 0.001637, 0.005944, 0.008521, 0.008278, 0.012981, 0.011535, 0.006821, 0.007673, 0.013333, 0.013627, 0.007335, 0.006621, 0.006884, 0.002985, -0.005134, -0.007202, -0.014552, -0.016203
#*# 	-0.026729, -0.029331, -0.026365, -0.022319, -0.025981, -0.023935, -0.023102, -0.017958, -0.016437, -0.016097, -0.014324, -0.008276, -0.004135, -0.000371, -0.004926, -0.001427, 0.000502, 0.000433, -0.002542, -0.005150, 0.001121, 0.004014, -0.002962, -0.003813, -0.006454, -0.005392, -0.008653, -0.016729, -0.018932, -0.024120
#*# 	-0.034739, -0.043259, -0.041117, -0.035903, -0.034530, -0.032051, -0.028621, -0.025728, -0.022029, -0.022922, -0.021369, -0.016790, -0.012670, -0.012305, -0.008150, -0.007570, -0.005673, -0.007244, -0.008904, -0.006642, -0.002078, -0.002756, -0.002794, -0.001566, -0.009698, -0.011321, -0.011124, -0.016799, -0.021870, -0.028896
#*# 	-0.039766, -0.043408, -0.044431, -0.043722, -0.043570, -0.040251, -0.040548, -0.037423, -0.031402, -0.030929, -0.028668, -0.021348, -0.014945, -0.013252, -0.005431, -0.001920, 0.001935, -0.002275, -0.008508, -0.009831, -0.003089, -0.002832, -0.006230, -0.011692, -0.013686, -0.015193, -0.015103, -0.014029, -0.020606, -0.030100
#*# 	-0.044166, -0.045782, -0.051439, -0.048327, -0.046785, -0.044673, -0.040916, -0.042482, -0.038611, -0.037788, -0.035802, -0.028291, -0.021825, -0.015655, -0.013533, -0.010503, -0.005066, -0.004827, -0.008984, -0.009604, -0.007178, -0.006552, -0.010882, -0.016371, -0.021896, -0.025632, -0.031534, -0.032917, -0.034428, -0.043277
#*# 	-0.051684, -0.055176, -0.059134, -0.054705, -0.054876, -0.049543, -0.046703, -0.052353, -0.052487, -0.049732, -0.048409, -0.044033, -0.039931, -0.034475, -0.030093, -0.022309, -0.017178, -0.017848, -0.016251, -0.016132, -0.016044, -0.019136, -0.025137, -0.028649, -0.033221, -0.041685, -0.044908, -0.051493, -0.056502, -0.060935
#*# 	-0.063488, -0.065966, -0.070059, -0.071327, -0.075965, -0.072453, -0.072700, -0.071472, -0.070073, -0.067782, -0.062749, -0.056357, -0.053081, -0.047212, -0.042612, -0.039780, -0.034478, -0.034099, -0.034041, -0.033689, -0.036064, -0.039957, -0.044771, -0.042962, -0.048871, -0.058308, -0.064163, -0.071759, -0.075841, -0.081856
#*# 	-0.081761, -0.086477, -0.086191, -0.088294, -0.089928, -0.093579, -0.087976, -0.084814, -0.085823, -0.082751, -0.079947, -0.078683, -0.072470, -0.070466, -0.066358, -0.060458, -0.055383, -0.055242, -0.055124, -0.052815, -0.052023, -0.056947, -0.061366, -0.063927, -0.069994, -0.077243, -0.085318, -0.090984, -0.097283, -0.106170
#*# 	-0.092997, -0.104121, -0.102029, -0.100989, -0.105847, -0.106674, -0.102843, -0.104248, -0.103399, -0.101764, -0.099223, -0.095346, -0.090002, -0.083309, -0.082573, -0.077120, -0.069907, -0.069504, -0.071298, -0.066048, -0.063127, -0.065629, -0.071243, -0.076043, -0.080569, -0.088337, -0.097494, -0.110170, -0.117213, -0.125323
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 310.0
#*# min_y = 30.0
#*# max_y = 310.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.714
#*# pid_ki = 2.313
#*# pid_kd = 77.138
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 75.6
#*# shaper_type_y = mzv
#*# shaper_freq_y = 42.4
#*#
#*# [scanner model default]
#*# model_coef = 1.5349431612374111,
#*# 	1.8490791169335126,
#*# 	0.7246485875328341,
#*# 	0.33515869666492754,
#*# 	0.47291338716324177,
#*# 	0.49033100926027273,
#*# 	-0.4326408652681163,
#*# 	-0.5655169257214352,
#*# 	0.34847390413322965,
#*# 	0.34143710812363404
#*# model_domain = 3.1920428108760154e-07,3.305421723951846e-07
#*# model_range = 0.199167,5.099167
#*# model_temp = 23.392779
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 2000
#*# scanner_touch_speed = 3
